<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MediWave ‚Äî AI Health Assistant</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg1: #0b2026;
      --bg2: #1a353f;
      --card: rgba(255, 255, 255, 0.12);
      --accent: #00c4b4; /* Aquatic teal for wave theme */
      --danger: #ff6b6b;
      --muted: #a0b0b6;
      --glass-border: rgba(255, 255, 255, 0.18);
      --text: #e6f7f2;
      --shadow: rgba(0, 0, 0, 0.4);
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    .app {
      display: flex;
      gap: 24px;
      max-width: 1400px;
      margin: 24px auto;
      padding: 16px;
      min-height: calc(100vh - 48px);
      position: relative;
    }

    /* Sidebar */
    .sidebar {
      width: 300px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 24px;
      backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      box-shadow: 0 12px 40px var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 20px;
      height: calc(100vh - 64px);
      overflow-y: auto;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: fixed;
      left: 24px;
      top: 24px;
      z-index: 1000;
      animation: waveGlow 4s infinite ease-in-out;
    }

    .sidebar:hover {
      box-shadow: 0 16px 48px var(--shadow);
    }

    .sidebar.collapsed {
      transform: translateX(-100%);
    }

    @keyframes waveGlow {
      0%, 100% { box-shadow: 0 12px 40px var(--shadow); }
      50% { box-shadow: 0 12px 48px rgba(0, 196, 180, 0.3); }
    }

    .sidebar-toggle {
      position: fixed;
      left: 16px;
      top: 16px;
      z-index: 1001;
      padding: 10px;
      border-radius: 10px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(15px);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px var(--shadow);
    }

    .sidebar-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px var(--shadow);
    }

    .brand {
      display: flex;
      gap: 12px;
      align-items: center;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--glass-border);
    }

    .avatar {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      object-fit: contain;
      background: linear-gradient(90deg, #00d4b8, #009688);
      box-shadow: 0 6px 16px var(--shadow);
      transition: transform 0.3s ease;
      padding: 4px;
    }

    .avatar:hover {
      transform: scale(1.05);
    }

    .avatar[src=""] {
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 24px;
      color: #021;
      content: "MW";
    }

    .brand h3 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
      color: var(--accent);
      text-shadow: 0 2px 4px var(--shadow);
    }

    .small { 
      color: var(--muted); 
      font-size: 13px; 
      opacity: 0.8;
    }

    .sidebar .btn {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 14px 18px;
      border-radius: 14px;
      border: 1px solid var(--glass-border);
      cursor: pointer;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      color: var(--text);
      transition: all 0.2s ease;
      font-weight: 500;
      font-size: 15px;
      backdrop-filter: blur(10px);
      animation: wavePulse 3s infinite ease-in-out;
    }

    .sidebar .btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px var(--shadow);
    }

    .btn.new {
      background: linear-gradient(90deg, #0f1720, rgba(255, 255, 255, 0.1));
      font-weight: 600;
      color: var(--accent);
    }

    .btn.primary {
      background: linear-gradient(90deg, var(--accent), #009688);
      color: #021;
      border: none;
      font-weight: 600;
    }

    @keyframes wavePulse {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-2px); }
    }

    .history-section {
      flex: 1;
      overflow-y: auto;
      padding: 10px 0;
    }

    .history-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 12px;
      cursor: pointer;
      color: var(--muted);
      font-size: 15px;
      transition: all 0.2s ease;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
    }

    .history-item:hover {
      background: rgba(255, 255, 255, 0.2);
      color: var(--text);
      transform: translateX(4px);
    }

    .history-item.active {
      background: linear-gradient(90deg, rgba(0, 196, 180, 0.2), rgba(255, 255, 255, 0.1));
      color: var(--accent);
    }

    .sidebar .footer {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      padding-top: 16px;
      border-top: 1px solid var(--glass-border);
      opacity: 0.8;
    }

    /* Main */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      height: calc(100vh - 64px);
      margin-left: 340px;
      transition: margin-left 0.3s ease;
    }

    .main.full-width {
      margin-left: 60px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 18px;
      background: linear-gradient(180deg, var(--card), rgba(255, 255, 255, 0.05));
      border: 1px solid var(--glass-border);
      border-radius: 18px;
      box-shadow: 0 6px 24px var(--shadow);
      backdrop-filter: blur(25px);
    }

    .header h2 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      color: var(--accent);
      text-shadow: 0 2px 4px var(--shadow);
    }

    .card {
      background: linear-gradient(180deg, var(--card), rgba(255, 255, 255, 0.05));
      border: 1px solid var(--glass-border);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 10px 36px var(--shadow);
      backdrop-filter: blur(25px);
    }

    /* Chat Area */
    .chat-area {
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 1;
      min-height: 0;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      background: rgba(0, 0, 0, 0.25);
      border-radius: 14px;
      border: 1px solid var(--glass-border);
      scrollbar-width: thin;
      scrollbar-color: var(--accent) transparent;
    }

    .messages::-webkit-scrollbar {
      width: 6px;
    }

    .messages::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 6px;
    }

    .msg {
      max-width: 80%;
      padding: 14px 18px;
      border-radius: 14px;
      line-height: 1.5;
      word-break: break-word;
      box-shadow: 0 6px 16px var(--shadow);
      backdrop-filter: blur(15px);
    }

    .msg.user {
      align-self: flex-end;
      background: linear-gradient(90deg, #0ea5ff, #60a5fa);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .msg.bot {
      align-self: flex-start;
      background: linear-gradient(90deg, var(--accent), #009688);
      color: #011;
      border-bottom-left-radius: 4px;
    }

    .msg.system {
      align-self: center;
      background: transparent;
      color: var(--muted);
      font-size: 14px;
      padding: 10px 14px;
      border-radius: 12px;
    }

    .input-row {
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 14px;
      background: linear-gradient(180deg, var(--card), rgba(255, 255, 255, 0.05));
      border: 1px solid var(--glass-border);
      border-radius: 14px;
      box-shadow: 0 6px 16px var(--shadow);
      backdrop-filter: blur(15px);
    }

    .input-row input[type="text"] {
      flex: 1;
      padding: 14px 18px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: rgba(0, 0, 0, 0.35);
      color: var(--text);
      outline: none;
      font-size: 16px;
      transition: all 0.2s ease;
    }

    .input-row input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px rgba(0, 196, 180, 0.4);
    }

    .send-btn, .voice-btn {
      padding: 14px 18px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      background: var(--accent);
      color: #021;
      font-weight: 600;
      box-shadow: 0 6px 16px var(--shadow);
      transition: all 0.2s ease;
      animation: wavePulse 3s infinite ease-in-out;
    }

    .send-btn:hover, .voice-btn:hover {
      background: #009688;
      transform: translateY(-2px);
    }

    .voice-btn.active {
      background: var(--danger);
    }

    .typing {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 10px 14px;
      background: rgba(255, 255, 255, 0.12);
      border-radius: 12px;
    }

    .typing .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--text);
      opacity: 0.3;
      animation: blink 1.2s infinite;
    }

    .typing .dot:nth-child(2) { animation-delay: 0.2s; }
    .typing .dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes blink {
      0%, 80%, 100% { opacity: 0.3; }
      40% { opacity: 1; }
    }

    .muted { color: var(--muted); font-size: 14px; }

    .danger {
      background: linear-gradient(90deg, #ff6b6b, #ff3b3b);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
    }

    .lang-select {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px;
    }

    .pill {
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--glass-border);
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
    }

    .pill:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .pill.active {
      border: 1px solid var(--accent);
      background: var(--accent);
      color: #021;
    }

    @media (max-width: 880px) {
      .app {
        flex-direction: column;
        padding: 12px;
        margin: 8px;
      }
      .sidebar {
        width: calc(100% - 32px);
        height: auto;
        left: 16px;
      }
      .main {
        margin-left: 0;
      }
      .main.full-width {
        margin-left: 0;
      }
      .chat-area {
        min-height: 50vh;
      }
    }

    canvas#particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
    }

    .vignette {
      pointer-events: none;
      position: fixed;
      inset: 0;
      background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.4) 100%);
      z-index: -1;
    }
  </style>
</head>
<body>
  <canvas id="particles"></canvas>
  <div class="vignette"></div>

  <div class="app container">
    <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>

    <aside class="sidebar card" role="navigation" aria-label="Sidebar">
      <div class="brand">
        <img src="https://i.ibb.co/mV9z3F7m/a-logo-design-featuring-the-text-mediwav-7-J1-E77-Vg-QOSMIwh-Ov-Ln-Ex-A-0-Cctf-V1n-Ro-Gs-S8o-1-Ov-Bg.jpg" alt="MediWave Logo" class="avatar">
        <div>
          <h3>MediWave</h3>
          <div class="small">Educational tool ‚Äî not a doctor</div>
        </div>
      </div>

      <button class="btn new" id="newChatBtn">+ New Chat</button>

      <div class="history-section" id="chatHistory"></div>

      <div>
        <button class="btn" id="dailyTipBtn">üí° Daily Health Tip</button>
        <button class="btn danger" id="emergencyBtnLeft">üö® Emergency Help</button>
      </div>

      <div class="lang-select">
        <div class="muted">Language</div>
        <div style="display: flex; gap: 10px; margin-top: 8px;">
          <div class="pill active" id="langEn">English</div>
          <div class="pill" id="langHi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</div>
        </div>
      </div>

      <div class="footer muted">
        Made by <strong>Atharv</strong> ‚Ä¢ Demo
      </div>
    </aside>

    <main class="main">
      <div class="header">
        <div>
          <h2>üí¨ MediWave</h2>
          <div class="muted">Ask about symptoms, diet, fitness, or wellness</div>
        </div>
      </div>

      <section class="chat-area card">
        <div id="messages" class="messages" aria-live="polite" role="log">
          <div class="msg system">Tip: This is an educational assistant. For emergencies, call local services.</div>
        </div>

        <div class="input-row">
          <input id="inputBox" type="text" placeholder="Ask about health, fitness, or diet..." aria-label="Message input" />
          <button class="voice-btn" id="voiceBtn" title="Voice Input">üéôÔ∏è</button>
          <button class="send-btn" id="sendBtn">Send</button>
        </div>
      </section>
    </main>
  </div>

  <script>
    const API_KEY = "your-openai-api-key";
    const USE_OPENAI = !!API_KEY;
    const OPENAI_ENDPOINT = "https://api.openai.com/v1/chat/completions";
    const MODEL = "gpt-4o-mini";

    let language = "english";
    let currentChatId = null;
    let chatHistory = JSON.parse(localStorage.getItem("chatHistory")) || [];
    let isSidebarCollapsed = false;

    const messagesEl = document.getElementById("messages");
    const inputBox = document.getElementById("inputBox");
    const sendBtn = document.getElementById("sendBtn");
    const voiceBtn = document.getElementById("voiceBtn");
    const newChatBtn = document.getElementById("newChatBtn");
    const dailyTipBtn = document.getElementById("dailyTipBtn");
    const emergencyBtnLeft = document.getElementById("emergencyBtnLeft");
    const langEn = document.getElementById("langEn");
    const langHi = document.getElementById("langHi");
    const chatHistoryEl = document.getElementById("chatHistory");
    const sidebarToggle = document.getElementById("sidebarToggle");
    const sidebar = document.querySelector(".sidebar");
    const main = document.querySelector(".main");

    // Sidebar toggle
    sidebarToggle.addEventListener("click", () => {
      isSidebarCollapsed = !isSidebarCollapsed;
      sidebar.classList.toggle("collapsed");
      main.classList.toggle("full-width");
      sidebarToggle.textContent = isSidebarCollapsed ? "‚ò∞" : "‚Üê";
    });

    function appendMessage(role, htmlContent, opts = {}) {
      const d = document.createElement("div");
      d.className = `msg ${role}`;
      if (opts.raw) d.innerHTML = htmlContent;
      else d.textContent = htmlContent;
      messagesEl.appendChild(d);
      d.scrollIntoView({ behavior: "smooth", block: "end" });
      if (currentChatId && role !== "system") {
        const chat = chatHistory.find(c => c.id === currentChatId);
        if (chat) {
          chat.messages.push({ role, content: htmlContent });
          saveChatHistory();
        }
      }
      return d;
    }

    function addTypingIndicator() {
      const el = document.createElement("div");
      el.className = "msg bot";
      el.innerHTML = `<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>`;
      messagesEl.appendChild(el);
      el.scrollIntoView({ behavior: "smooth", block: "end" });
      return el;
    }

    function fallbackAnswer(userText) {
      const s = userText.toLowerCase();
      if (/(fever|temperature|cough|cold|sore throat)/.test(s)) {
        return language === "hindi"
          ? "‡§Ø‡•á ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¨‡•Å‡§ñ‡§æ‡§∞/‡§∏‡§∞‡•ç‡§¶‡•Ä ‡§ï‡•á ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç, ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Å ‡§î‡§∞ ‡§ú‡§∞‡•Ç‡§∞‡§§ ‡§™‡•ú‡•á ‡§§‡•ã ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§"
          : "These sound like flu/cold symptoms. Rest, stay hydrated, and consult a doctor if symptoms worsen.";
      }
      if (/(headache|migraine|dizzy)/.test(s)) {
        return language === "hindi"
          ? "‡§∏‡§∞‡§¶‡§∞‡•ç‡§¶ ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§§‡§®‡§æ‡§µ ‡§Ø‡§æ ‡§™‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡•Ä ‡§µ‡§ú‡§π ‡§∏‡•á ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§ ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Å ‡§î‡§∞ ‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç‡•§"
          : "Headaches can be from dehydration or stress. Drink water and rest.";
      }
      if (/(stomach|vomit|diarrhea|nausea)/.test(s)) {
        return language === "hindi"
          ? "‡§™‡•á‡§ü ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§π‡§≤‡•ç‡§ï‡§æ ‡§≠‡•ã‡§ú‡§® ‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Å‡•§ ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§π‡•ã‡§Ç ‡§§‡•ã ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç‡•§"
          : "For stomach issues, stick to light food and hydrate. See a doctor if severe.";
      }
      if (/(exercise|workout|fitness)/.test(s)) {
        return language === "hindi"
          ? "‡§µ‡•ç‡§Ø‡§æ‡§Ø‡§æ‡§Æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 3-4 ‡§¨‡§æ‡§∞/‡§∏‡§™‡•ç‡§§‡§æ‡§π ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ß‡•Ä‡§∞‡•á-‡§ß‡•Ä‡§∞‡•á ‡§∏‡§Æ‡§Ø ‡§¨‡§¢‡§º‡§æ‡§è‡§Å‡•§"
          : "Aim for regular exercise 3‚Äì4 times per week; increase duration gradually.";
      }
      if (/(diet|food|what to eat)/.test(s)) {
        return language === "hindi"
          ? "‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ ‡§Ü‡§π‡§æ‡§∞ ‡§≤‡•á‡§Ç: ‡§´‡§≤, ‡§∏‡§¨‡•ç‡§ú‡§ø‡§Ø‡§æ‡§Å, ‡§™‡•ç‡§∞‡•ã‡§ü‡•Ä‡§® ‡§î‡§∞ ‡§™‡§æ‡§®‡•Ä ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ ‡§¶‡•á‡§Ç‡•§"
          : "Eat a balanced diet: fruits, vegetables, protein, and stay hydrated.";
      }
      return language === "hindi"
        ? "‡§Æ‡•Å‡§ù‡•á ‡§ï‡•á‡§µ‡§≤ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø, ‡§Ü‡§π‡§æ‡§∞, ‡§´‡§ø‡§ü‡§®‡•á‡§∏ ‡§î‡§∞ ‡§µ‡•á‡§≤‡§®‡•á‡§∏ ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á ‡§∏‡§µ‡§æ‡§≤ ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§"
        : "Please ask only health, diet, fitness, or wellness related questions.";
    }

    async function callOpenAI(userText) {
      const systemMsg = language === "hindi"
        ? "‡§Ü‡§™ ‡§è‡§ï AI ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•à‡§Ç‡•§ ‡§ï‡•á‡§µ‡§≤ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø, ‡§´‡§ø‡§ü‡§®‡•á‡§∏, ‡§Ü‡§π‡§æ‡§∞, ‡§î‡§∞ ‡§µ‡•á‡§≤‡§®‡•á‡§∏ ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§"
        : "You are an AI Health Assistant. Only answer health, fitness, diet, and wellness related questions. Politely refuse unrelated queries.";
      const payload = {
        model: MODEL,
        messages: [
          { role: "system", content: systemMsg },
          { role: "user", content: userText }
        ],
        temperature: 0.2,
        max_tokens: 512
      };
      const res = await fetch(OPENAI_ENDPOINT, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${API_KEY}`
        },
        body: JSON.stringify(payload)
      });
      if (!res.ok) {
        const txt = await res.text();
        throw new Error("OpenAI error: " + (txt || res.status));
      }
      const data = await res.json();
      return data.choices?.[0]?.message?.content || "Sorry, no reply.";
    }

    function typeWriterInto(el, text, speed = 18) {
      return new Promise(resolve => {
        el.textContent = "";
        let i = 0;
        const interval = setInterval(() => {
          el.textContent += text.charAt(i) || "";
          i++;
          el.scrollIntoView({ behavior: "smooth", block: "end" });
          if (i > text.length) {
            clearInterval(interval);
            resolve();
          }
        }, speed);
      });
    }

    async function handleSend(text) {
      if (!text) return;
      appendMessage("user", text);
      inputBox.value = "";
      inputBox.focus();

      const typingEl = addTypingIndicator();
      try {
        let reply = USE_OPENAI ? await callOpenAI(text) : await new Promise(r => setTimeout(() => r(fallbackAnswer(text)), 700));
        typingEl.remove();
        const botEl = appendMessage("bot", "");
        await typeWriterInto(botEl, reply, 16);
      } catch (err) {
        typingEl.remove();
        appendMessage("bot", "‚ö†Ô∏è Error: " + (err.message || "Network / API error"));
        console.error(err);
      }
    }

    const recognition = window.SpeechRecognition ? new window.SpeechRecognition() : null;
    if (recognition) {
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      voiceBtn.addEventListener("click", () => {
        if (voiceBtn.classList.contains("active")) {
          recognition.stop();
          voiceBtn.classList.remove("active");
        } else {
          recognition.lang = language === "hindi" ? "hi-IN" : "en-US";
          recognition.start();
          voiceBtn.classList.add("active");
        }
      });

      recognition.onresult = event => {
        const transcript = event.results[0][0].transcript;
        inputBox.value = transcript;
        handleSend(transcript);
      };

      recognition.onend = () => {
        voiceBtn.classList.remove("active");
      };

      recognition.onerror = event => {
        voiceBtn.classList.remove("active");
        appendMessage("system", "Voice input error: " + event.error);
      };
    } else {
      voiceBtn.style.display = "none";
    }

    function saveChatHistory() {
      localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
      renderChatHistory();
    }

    function newChat() {
      currentChatId = Date.now().toString();
      chatHistory.push({
        id: currentChatId,
        title: "Chat " + (chatHistory.length + 1),
        messages: [],
        createdAt: new Date().toISOString()
      });
      messagesEl.innerHTML = "";
      appendMessage("system", language === "hindi" ? "‡§®‡§Ø‡§æ ‡§ö‡•à‡§ü ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§" : "New chat started.");
      saveChatHistory();
    }

    function renderChatHistory() {
      chatHistoryEl.innerHTML = "";
      chatHistory.forEach(chat => {
        const el = document.createElement("div");
        el.className = `history-item ${chat.id === currentChatId ? "active" : ""}`;
        el.innerHTML = `
          <span>üí¨ ${chat.title}</span>
          <span class="muted" style="font-size: 13px;">${new Date(chat.createdAt).toLocaleDateString()}</span>
        `;
        el.onclick = () => {
          currentChatId = chat.id;
          messagesEl.innerHTML = "";
          chat.messages.forEach(msg => appendMessage(msg.role, msg.content));
          renderChatHistory();
        };
        chatHistoryEl.appendChild(el);
      });
    }

    function dailyTip() {
      const tips = [
        "Drink at least 8 glasses of water daily.",
        "Sleep 7‚Äì8 hours for better recovery.",
        "Include fruits & vegetables every day.",
        "Take short walks after meals for digestion.",
        "Limit screen time before bed for improved sleep."
      ];
      const tip = tips[Math.floor(Math.random() * tips.length)];
      appendMessage("bot", "üí° " + tip);
    }

    function emergencyHelp() {
      const msg = language === "hindi"
        ? "üö® ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§§‡•Å‡§∞‡§Ç‡§§ 108 (‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏) ‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§∞ ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç!"
        : "üö® In an emergency, call 108 (ambulance India) or your local emergency number immediately!";
      appendMessage("bot", msg);
    }

    sendBtn.addEventListener("click", () => handleSend(inputBox.value.trim()));
    inputBox.addEventListener("keydown", e => { if (e.key === "Enter") handleSend(inputBox.value.trim()); });
    newChatBtn.addEventListener("click", newChat);
    dailyTipBtn.addEventListener("click", dailyTip);
    emergencyBtnLeft.addEventListener("click", emergencyHelp);
    langEn.addEventListener("click", () => {
      language = "english";
      langEn.classList.add("active");
      langHi.classList.remove("active");
      appendMessage("system", "Language set to English");
    });
    langHi.addEventListener("click", () => {
      language = "hindi";
      langHi.classList.add("active");
      langEn.classList.remove("active");
      appendMessage("system", "‡§≠‡§æ‡§∑‡§æ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä ‡§™‡§∞ ‡§∏‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à");
    });

    if (chatHistory.length === 0) {
      newChat();
    } else {
      currentChatId = chatHistory[0].id;
      chatHistory[0].messages.forEach(msg => appendMessage(msg.role, msg.content));
      renderChatHistory();
    }
    appendMessage("bot", language === "hindi"
      ? "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ MediWave ‡§π‡•á‡§≤‡•ç‡§• ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•Ç‡§Å ‚Äî ‡§Æ‡•Å‡§ù‡§∏‡•á ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø, ‡§´‡§ø‡§ü‡§®‡•á‡§∏ ‡§î‡§∞ ‡§Ü‡§π‡§æ‡§∞ ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§"
      : "Hello! I'm your MediWave Health Assistant ‚Äî ask me about health, fitness, or diet.");

    // 3D Particles with Wave Motion
    (function particles() {
      const canvas = document.getElementById("particles");
      const ctx = canvas.getContext("2d");
      let DPR = window.devicePixelRatio || 1;

      function resize() {
        canvas.width = innerWidth * DPR;
        canvas.height = innerHeight * DPR;
        canvas.style.width = innerWidth + "px";
        canvas.style.height = innerHeight + "px";
        ctx.scale(DPR, DPR);
      }
      window.addEventListener("resize", resize);
      resize();

      const particlesArray = [];
      const numParticles = Math.min(120, Math.floor((innerWidth * innerHeight) / 9000));
      const fov = 500; // Field of view for 3D perspective

      class Particle {
        constructor() {
          this.x = Math.random() * innerWidth;
          this.y = Math.random() * innerHeight;
          this.z = Math.random() * fov;
          this.size = 2 + Math.random() * 3;
          this.vx = (Math.random() - 0.5) * 0.8;
          this.vy = (Math.random() - 0.5) * 0.8;
          this.vz = (Math.random() - 0.5) * 0.8;
          this.hue = 160 + Math.random() * 60;
          this.waveOffset = Math.random() * Math.PI * 2; // For wave-like motion
        }

        update() {
          this.x += this.vx;
          this.y += this.vy + Math.sin(Date.now() * 0.002 + this.waveOffset) * 0.5; // Wave-like motion
          this.z += this.vz;

          // Bounce off boundaries
          if (this.z < 10) {
            this.z = 10;
            this.vz *= -0.8;
          } else if (this.z > fov) {
            this.z = fov;
            this.vz *= -0.8;
          }
          if (this.x < -50) this.x = innerWidth + 50;
          if (this.x > innerWidth + 50) this.x = -50;
          if (this.y < -50) this.y = innerHeight + 50;
          if (this.y > innerHeight + 50) this.y = -50;
        }

        draw() {
          // Perspective projection with wave scaling
          const scale = fov / (fov + this.z);
          const x2d = this.x * scale + innerWidth / 2;
          const y2d = this.y * scale + innerHeight / 2;
          const scaledSize = this.size * scale * (1 + 0.2 * Math.sin(Date.now() * 0.002 + this.waveOffset));
          ctx.beginPath();
          ctx.fillStyle = `hsla(${this.hue}, 80%, 60%, ${0.3 * scale})`;
          ctx.arc(x2d, y2d, scaledSize, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      for (let i = 0; i < numParticles; i++) {
        particlesArray.push(new Particle());
      }

      function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const g = ctx.createLinearGradient(0, 0, innerWidth, innerHeight);
        g.addColorStop(0, 'rgba(10, 30, 40, 0.2)');
        g.addColorStop(1, 'rgba(30, 60, 70, 0.2)');
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, innerWidth, innerHeight);

        particlesArray.forEach(particle => {
          particle.update();
          particle.draw();
        });

        // Draw wave-like connections
        for (let i = 0; i < particlesArray.length; i++) {
          for (let j = i + 1; j < particlesArray.length; j++) {
            const p1 = particlesArray[i];
            const p2 = particlesArray[j];
            const scale1 = fov / (fov + p1.z);
            const scale2 = fov / (fov + p2.z);
            const x1 = p1.x * scale1 + innerWidth / 2;
            const y1 = p1.y * scale1 + innerHeight / 2;
            const x2 = p2.x * scale2 + innerWidth / 2;
            const y2 = p2.y * scale2 + innerHeight / 2;
            const dist = Math.hypot(x1 - x2, y1 - y2);

            if (dist < 100) {
              const waveOpacity = 0.1 * (1 - dist / 100) * (1 + 0.3 * Math.sin(Date.now() * 0.002));
              ctx.beginPath();
              ctx.strokeStyle = `hsla(${p1.hue}, 70%, 50%, ${waveOpacity})`;
              ctx.lineWidth = 0.5;
              ctx.moveTo(x1, y1);
              ctx.lineTo(x2, y2);
              ctx.stroke();
            }
          }
        }

        requestAnimationFrame(loop);
      }
      loop();
    })();

    window.addEventListener("load", () => { inputBox.focus(); });
  </script>
</body>
</html>
